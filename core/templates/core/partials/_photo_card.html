{% comment %} core/partials/_photo_card.html {% endcomment %}
{% load i18n %}

<div id="photo-card-{{ detail_item.photo.id }}"
     class="bg-white rounded-lg shadow-lg flex flex-col group relative transition-all duration-300 ease-in-out">
     {# `group` for hover effects on children, `relative` for z-index context. No overflow-hidden here. #}

  {# Image Container - maintains space, allows image to pop out #}
  <div class="h-56 w-full relative">
    {# The <a> tag is kept for semantics if you want a link eventually, otherwise could be a div #}
    {# If you have a detail page for the photo, link to: detail_item.photo.get_absolute_url or similar #}
    <img src="{{ detail_item.photo.image.url }}"
      class="absolute inset-0 w-full h-full object-contain rounded-t-lg
        transition-all duration-300 ease-in-out
        hover:scale-150 hover:z-20
        hover:bg-gray-50
        hover:rounded-md hover:shadow-2xl"
      alt="{% blocktranslate with uploader=detail_item.photo.uploaded_by.username %}Photo by {{ uploader }}{% endblocktranslate %}"
      loading="lazy" />
  </div>

  <div id="photo-card-body-{{ detail_item.photo.id }}" class="p-4 flex-grow flex flex-col z-0">
    {# z-0 ensures this content stays below the hovered image which will have a higher z-index #}
    <div class="mb-3">
      <p class="text-xs text-gray-500">
        {% blocktranslate with uploader=detail_item.photo.uploaded_by.username date=detail_item.photo.uploaded_at|date:"Y-m-d" %}
          Uploaded by {{ uploader }} on {{ date }}
        {% endblocktranslate %}
      </p>
    </div>

      {# Form to assign/update tags #}
      <form method="post"
            action="{% url 'assign_photo_tags' group_pk=group.id photo_pk=detail_item.photo.id %}"
            class="space-y-2"
            hx-post="{% url 'assign_photo_tags' group_pk=group.id photo_pk=detail_item.photo.id %}"
            hx-target="#photo-card-{{ detail_item.photo.id }}"
            hx-select="#photo-card-{{ detail_item.photo.id }}"
            hx-swap="outerHTML"
            hx-select-oob="#messages-container:outerHTML">
        {% csrf_token %}
        {{ detail_item.tag_assignment_form.media }}
        <div>
            <label for="{{ detail_item.tag_assignment_form.tags_to_assign.id_for_label }}" class="sr-only">{{ detail_item.tag_assignment_form.tags_to_assign.label }}</label>
            {# This field benefits GREATLY from a widget like django-select2 or django-tomselect #}
            {# Add Tailwind classes for basic styling if it's a standard select/multiselect #}
            {# e.g., class="form-multiselect block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" #}
            {{ detail_item.tag_assignment_form.tags_to_assign }}
            {% if detail_item.tag_assignment_form.tags_to_assign.errors %}
                <div class="text-red-500 text-xs mt-1">
                    {{ detail_item.tag_assignment_form.tags_to_assign.errors|join:", " }}
                </div>
            {% endif %}
        </div>
        <button type="submit" class="w-full px-3 py-2 bg-indigo-600 text-white text-sm font-semibold rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
            {% translate "Update Tags" %}
        </button>
      </form>
    </div>

    {# Actions at the bottom #}
    <div class="mt-auto pt-3 border-t border-gray-200">
      <form method="post"
            action="{% url 'remove_photo_from_group' group_pk=group.id photo_pk=detail_item.photo.id %}"
            hx-post="{% url 'remove_photo_from_group' group_pk=group.id photo_pk=detail_item.photo.id %}"
            hx-target="#group-photos-section"
            hx-select="#group-photos-section"
            hx-swap="outerHTML"
            hx-select-oob="#messages-container:outerHTML"
            hx-confirm="{% blocktranslate %}Are you sure you want to remove this photo from the group?{% endblocktranslate %}">
        {% csrf_token %}
        <button type="submit" class="w-full px-3 py-2 bg-red-500 text-white text-sm font-semibold rounded-md shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150" title="{% translate 'Remove photo from group' %}">
          {% translate "Remove from Group" %}
        </button>
      </form>
    </div>
  </div>
</div>